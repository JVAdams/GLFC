adult <- read.csv(paste0(FOLDER, INDEX.LAKE))
names(adult)[names(adult)=="year"] <- "spawner.year"
names(adult)[names(adult)=="ilo"] <- "index.lo"
names(adult)[names(adult)=="ihi"] <- "index.hi"
# Lakewide treatment effort
control1 <- read.csv(paste0(FOLDER, CONTROL), skip=1)
names(control1) <- casefold(names(control1))
days <- unlist(control1[, grep("day", names(control1))])
tfm <- unlist(control1[, grep("tfm", names(control1))])
bayer <- unlist(control1[, grep("bayer", names(control1))])
nobs <- length(control1$year)
reps <- length(days)/nobs
year <- rep(control1$year, reps)
lake <- rep(1:6, rep(nobs, 6))
control <- data.frame(treat.year=year, lake=lake, staff.days=days,
tfmkgai=tfm, bayerkgai=bayer)
control <- control[control$lake < 5.5, ]
control$spawner.year <- control$treat.year + 2
control <- control[control$lake < 5.5, ]
rm(CONTROL, control1, days, tfm, bayer, nobs, reps, year, lake)
# Lakewide lake trout relative abundance estimates and wounding rates
troutfiles <- c(TROUTSUP, TROUTMIC, TROUTHUR, TROUTERI, TROUTONT)
trouts <- vector("list", 5)
# if trout data is missing a desired column,
#   create a column of missing values for it
selcols <- c("year", "lake", "cpe", "lo", "hi", "wound", "wlo", "whi")
for(i in seq(troutfiles)) {
df <- read.csv(paste0(FOLDER, troutfiles[i]))
df$lake <- i
need.names <- setdiff(selcols, names(df))
if (length(need.names) > 0) {
df[, need.names] <- NA
}
trouts[[i]] <- df[, selcols]
}
trout <- do.call(rbind, trouts)
names(trout) <- c("trout.year", "lake", "trout", "trout.lo", "trout.hi",
"rate", "rate.lo", "rate.hi")
# Only Superior and Huron trout are assessed in spring
trout$spawner.year <- ifelse((trout$lake==1 | trout$lake==3),
trout$trout.year, trout$trout.year+1)
trout$wound.unit <- ifelse(trout$lake==5, '# A1 marks per 100 LAT >17"',
'# A1-A3 marks per 100 LAT >21"')
rm(troutfiles, trouts, selcols, TROUTSUP, TROUTMIC, TROUTHUR, TROUTERI,
TROUTONT)
#### Targets ####
sptargyrz <- list(1994:1998, 1988:1992, 1989:1993, 1991:1995, 1993:1997)
sptargyrz <- list(1994:1998, 1995:1999, 1989:1993, 1991:1995, 1993:1997)
TARGET <- data.frame(lake=1:5, wound.target=rep(c(5, 2), c(4, 1)),
wound.units=rep(c("A1-A3", "A1"), c(4, 1)),
index.target=rep(NA, 5), intarg.lo=rep(NA, 5), intarg.hi=rep(NA, 5))
for(i in 1:5) {
pick5 <- adult$index[adult$lake==i & is.element(adult$spawner.year,
sptargyrz[[i]])]
TARGET$index.target[i] <- mean(pick5)
n <- length(pick5)
ci <- qnorm(1 - 0.05/2) * sqrt(var(pick5)) / sqrt(n)
TARGET[i, 5:6] <- mean(pick5) + c(-1, 1)*ci	# using z dist (known variance)
if (i==2) TARGET[i, 4:6] <- (5/8.9)*TARGET[i, 4:6]
if (i==3) TARGET[i, 4:6] <- 0.25*TARGET[i, 4:6]
}
targyrz <- apply(sapply(sptargyrz, range), 2, paste, collapse="-")
#  rm(pick5, sptargyrz)
name.targ <- paste0("StatusTargets", TODAY, ".csv")
write.csv(TARGET, paste0(FOLDER, name.targ), row.names=FALSE)
# adult data
stream <- read.csv(paste0(FOLDER, INDEX.STREAM))
stream$row <- 1:dim(stream)[1]
YEAR <- max(stream$year)
dfthis <- stream[stream$year == YEAR, ]
dfthis <- dfthis[order(dfthis$lake, -dfthis$indexContrib), ]
# prepare to plot adult estimates on  map, showing source of estimate ...
#   label those with highest estimates
max.dia.lat <- c(0.42, 0.39, 0.28, 0.28, 0.23)
space.below.lat <- c(0.15, 0.19, 0.16, 0.09, 0.07)
# max larval data
maxlarvae <- read.csv(paste0(FOLDER, MAXLARVAE))
names(maxlarvae) <- make.names(casefold(names(maxlarvae)), unique=TRUE,
allow_=FALSE)
maxlarvae$row <- 1:dim(maxlarvae)[1]
# drop "river" or "creek" from stream name
namesplit <- strsplit(maxlarvae$stream.nam, " ")
nameend <- sapply(namesplit, function(x) rev(x)[1])
suffixes <- c("Brook", "Cr.", "Creek", "R.", "River", "Rivers")
maxlarvae$stream.nam <- sapply(namesplit, function(x) {
keep <- if (rev(x)[1] %in% suffixes) {
rev(x)[-1]
} else {
rev(x)
}
paste(rev(keep), collapse=" ")
})
# streams that make up top 50% of max larvae over many years
top50maxlarvae <- top50pct(dfvar=maxlarvae, xvar="estimate", byvar="lake")
top50maxlarvae$textpaste <- paste(top50maxlarvae$stream.nam,
format(signif(top50maxlarvae$estimate, 2), big.mark=",", trim=TRUE))
#### All lakewide data combined ####
a <- merge(adult, control, all=TRUE)
ALL <- merge(a, trout, all=TRUE)
ALL$treat.year <- ALL$spawner.year - 2
ALL$wound.year <- ALL$spawner.year - 1
# the season for Lake Huron has been confirmed by Ji He 4/13/09
ALL$season[is.element(ALL$lake, c(1, 3))] <- "spring"
ALL$season[is.element(ALL$lake, c(2, 4, 5))] <- "fall"
sel <- is.na(ALL$trout.year)
ALL$trout.year[sel] <- ifelse(ALL$season[sel]=="spring",
ALL$spawner.year[sel], ALL$spawner.year[sel]-1)
# calculate three-year running mean for adults, marks, and trout
ALL <- ALL[order(ALL$lake, ALL$spawner.year), ]
varz <- c("index", "trout", "rate")
look <- ddply(.data=ALL[, c("lake", varz)], .variables=.(lake), .drop=FALSE,
.fun=rollapply, width=3, FUN=CI, fill=c(NA, NA, NA), align="right")
names(look)[-(1:4)] <- paste(rep(varz, rep(3, length(varz))),
rep(c("3mn", "3lo", "3hi"), length(varz)), sep=".")
ALL <- cbind(ALL, look[, -(1:4)])
name.dat <- paste0("StatusMetrics", TODAY, ".csv")
write.csv(ALL, paste0(FOLDER, name.dat), row.names=FALSE)
rm(adult, control, a, trout, varz, look)
names(ALL)
attach(ALL)
#### status and trends ####
addPageBreak(this=doc, width=8.5, height=11, omi=c(1, 1, 1, 1))
heading("SEA LAMPREY STATUS IN THE GREAT LAKES")
# adult 3-year status and 5-year trend
sp <- SRstatus(bydat=lake, timedat=spawner.year,
measdat=index, targdat=TARGET$index.target[1:5])
# categ <- ifelse(sp$status=="Met", "Satisfactory", "Unsatisfactory")
# categ[sp$status=="Above" & sp$trend=="Decr."] <- "Improving"
# sp$stattrnd <- paste0(categ, ":  ", sp$status, ", ", sp$trend)
sp$stattrnd <- paste0(sp$status, ", ", sp$trend)
sp1 <- SRstatus(bydat=lake, timedat=spawner.year,
measdat=index, targdat=TARGET$index.target[1:5],
status.length=1, trend.length=NULL)
# wounding 3-year status and 5-year trend
wo <- SRstatus(bydat=lake, timedat=trout.year,
measdat=rate, targdat=TARGET$wound.target[1:5])
wo$stattrnd <- paste(wo$status, wo$trend, sep=", ")
wo1 <- SRstatus(bydat=lake, timedat=trout.year,
measdat=rate, targdat=TARGET$wound.target[1:5],
status.length=1, trend.length=NULL)
# trout 5-year trend
tr <- SRstatus(bydat=lake, timedat=trout.year,
measdat=trout, targdat=NULL, status.length=NULL)
tab <- cbind(sp[, c("bydat", "stattrnd")], wo[, "stattrnd"], tr[, "trend"])
tab$bydat <- Lakenames[tab$bydat]
names(tab) <- c("Lake", "Sea Lamprey", "Marks", "Lake Trout")
tabl("Sea lamprey control program success is measured by index estimates",
" of adult sea lamprey abundance, sea lamprey marking rates on lake trout,",
" and lake trout relative abundance.  The overall status of these metrics",
" is presented in this table;",
" status is based on the mean over the last 3 years relative to target,",
" trends are based on the slope over the last 5 years.",
TAB=tab, row.names=FALSE)
# REPORT CARD
# merge metrics data with targets
ALL2 <- merge(ALL, TARGET[, c("lake", "wound.target", "index.target")],
all.x=TRUE)
names(ALL2)
is.na(ALL$spawner.year)
home(is.na(ALL$spawner.year))
sum(is.na(ALL$spawner.year))
ALL2 <- ALL2[!is.na(ALL2$spawner.year), ]
inr <- with(ALL2, index/index.target)
inr[is.na(inr)] <- 0
wrr <- with(ALL2, rate/wound.target)
wrr[is.na(wrr)] <- 0
score <- (inr + wrr)/((inr>0) + (wrr>0))
ALL2$above.score <- score
# base line width and type on status average for last 5 years
last5 <- (YEAR - ALL2$spawner.year) < 4.5
mean3 <- tapply(ALL2$above.score[last5], ALL2$lake[last5], mean, na.rm=TRUE)
# lwid <- round(rescale(mean3, c(1, 5)))
# ltyp <- recode(lwid, 5:1, c(1, 5, 4, 2, 3))
last1 <- ALL2$spawner.year == YEAR
labsep <- function(x, minsep=diff(range(x))/(2*(length(x) - 1))) {
ord <- order(x)
dif1 <- diff(x[ord])
dif2 <- dif1
dif2[dif2<minsep] <- minsep
dif3 <- dif2 * sum(dif1) / sum(dif2)
y <- x
y[ord] <- cumsum(c(min(x), dif3))
y
}
xr <- range(ALL2$spawner.year[(YEAR - ALL2$spawner.year) < 4.5 &
(!is.na(ALL2$index) | !is.na(ALL2$rate))])
yr <- range((ALL2$index/ALL2$index.target)[last5 & !is.na(ALL2$index)],
(ALL2$rate/ALL2$wound.target)[last5 & !is.na(ALL2$rate)], na.rm=TRUE)
par(mfrow=c(1, 2), mar=c(2, 3, 2, 4), oma=c(1, 1, 0, 0))
plot(ALL2$wound.year, ALL2$index/ALL2$index.target, type="n", las=1,
xlim=xr, ylim=yr, xlab="", ylab="")
mtext("Adult sea lamprey index", side=3, line=0.5)
pusr <- par("usr")
polygon(pusr[c(1, 2, 2, 1)], c(pusr[c(3, 3)], 1, 1), col="lightgray",
border=NA)
box()
labeloc <- labsep((ALL2$index/ALL2$index.target)[ALL2$spawner.year==YEAR])
par(mfrow=c(1, 2), mar=c(2, 3, 2, 4), oma=c(1, 1, 0, 0))
plot(ALL2$wound.year, ALL2$index/ALL2$index.target, type="n", las=1,
xlim=xr, ylim=yr, xlab="", ylab="")
mtext("Adult sea lamprey index", side=3, line=0.5)
pusr <- par("usr")
polygon(pusr[c(1, 2, 2, 1)], c(pusr[c(3, 3)], 1, 1), col="lightgray",
border=NA)
box()
labeloc <- labsep((ALL2$index/ALL2$index.target)[ALL2$spawner.year==YEAR])
for(i in 1:5) {
sel <- ALL2$lake==i
lines(ALL2$wound.year[sel], (ALL2$index/ALL2$index.target)[sel],
col=blindcolz[c(2, 3, 4, 6, 8)[i]], lwd=2, lty=i,
lend="square")
mtext(Lakenames[i], at=labeloc[i], col=blindcolz[c(2, 3, 4, 6, 8)[i]],
side=4, las=2, line=0.5)
}
plot(ALL2$wound.year, ALL2$rate/ALL2$wound.target, type="n", las=1,
xlim=xr, ylim=yr, xlab="", ylab="")
mtext("Lake trout marking rate", side=3, line=0.5)
pusr <- par("usr")
polygon(pusr[c(1, 2, 2, 1)], c(pusr[c(3, 3)], 1, 1), col="lightgray",
border=NA)
box()
labeloc <- labsep(with(ALL2, tapply(rate/wound.target, lake,
function(x) rev(x[!is.na(x)])[1])))
for(i in 1:5) {
sel <- ALL2$lake==i
lines(ALL2$wound.year[sel], (ALL2$rate/ALL2$wound.target)[sel],
col=blindcolz[c(2, 3, 4, 6, 8)[i]], lwd=2, lty=i,
lend="square")
mtext(Lakenames[i], at=labeloc[i], col=blindcolz[c(2, 3, 4, 6, 8)[i]],
side=4, las=2, line=0.5)
}
mtext("Wounding year", side=1, outer=TRUE)
mtext("Relative to target", side=2, outer=TRUE)
sul <- sort(unique(lake))
i
i <- 1
GLFCenv$figcount <- 1
sel <- lake==sul[i]
addPageBreak(this=doc, width=8.5, height=11, omi=c(1, 1, 1, 1))
heading(paste("STATUS OF SEA LAMPREY CONTROL IN LAKE",
casefold(Lakenames[i], upper=TRUE)))
heading("Adult Sea Lamprey:", 2)
par(mar=c(4, 4, 0.5, 4), yaxs="i")
plot(wound.year[sel], index[sel]/1000, type="n", axes=FALSE,
xlim=range(year.tk), ylim=range(index.tk)/1000, xlab="Spawning year",
ylab="Adult sea lamprey index  (thousands)")
plot(wound.year[sel], index[sel]/1000, type="n", axes=FALSE,
xlab="Spawning year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
shadepoly(x=wound.year, ymd=index.3mn/1000,
ylo=index.3lo/1000,
yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
par(mar=c(4, 4, 0.5, 4), yaxs="i")
plot(wound.year[sel], index[sel]/1000, type="n", axes=FALSE,
xlab="Spawning year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
shadepoly(x=wound.year, ymd=index.3mn/1000,
ylo=index.3lo/1000,
yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar])
?shadepoly
par(mar=c(4, 4, 0.5, 4), yaxs="i")
plot(wound.year[sel], index[sel]/1000, type="n", axes=FALSE,
xlab="Spawning year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
par(mar=c(4, 4, 0.5, 4), yaxs="i")
plot(wound.year[sel], index[sel]/1000, type="n",
xlab="Spawning year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
sel1 <- lake==sul[i]
par(mar=c(4, 4, 0.5, 4), yaxs="i")
sel <- sel1 & !is.na(index)
plot(wound.year[sel], index[sel]/1000, type="n",
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
par(mar=c(4, 4, 0.5, 4), yaxs="i")
sel <- sel1 & !is.na(index)
plot(wound.year[sel], index[sel]/1000, type="n",
ylim=range(0, index.hi[sel]/1000),
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
plot(wound.year[sel], index[sel]/1000, type="n",
ylim=1.05*range(0, index.hi[sel]/1000),
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
par(mar=c(4, 4, 0.5, 4), yaxs="i", las=1)
sel <- sel1 & !is.na(index)
plot(wound.year[sel], index[sel]/1000, type="n",
ylim=1.05*range(0, rev(index.hi[sel]/1000)[1:20]),
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
axis(4, las=2, adj=1, at=pe.tk, labels=pe.lab)
box(bty="l")
axis(4, las=2, adj=1, at=pe.tk, labels=pe.lab)
pretty(index[sel]/1000*4)
pretty(index[sel]/1000 / index2pe[i])
pretty(index[sel]/1000 * index2pe[i])
??pretty
plab <- pretty(index[sel]/1000 * index2pe[i])
axis(4, at=plab/index2pe[i], labels=plab)
par(mar=c(4, 4, 0.5, 4), yaxs="i", las=1)
sel <- sel1 & !is.na(index)
yr <- 1.02*range(0, rev(index.hi[sel]/1000)[1:20])
plot(wound.year[sel], index[sel]/1000, type="n", ylim=yr,
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
plab <- pretty(yr * index2pe[i])
axis(4, at=plab/index2pe[i], labels=plab)
axis(2, at=plab/index2pe[i], labels=plab, outer=TRUE)
par(mar=c(4, 4, 0.5, 4), oma=c(0, 4, 0, 0), yaxs="i", las=1)
sel <- sel1 & !is.na(index)
yr <- 1.02*range(0, rev(index.hi[sel]/1000)[1:20])
plot(wound.year[sel], index[sel]/1000, type="n", ylim=yr,
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
mtext("Population estimate  (thousands)", side=4, line=3)
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
plab <- pretty(yr * index2pe[i])
axis(2, at=plab/index2pe[i], labels=plab, outer=TRUE)
axis(4, las=2, adj=1, at=pe.tk, labels=pe.lab)
box(bty="l")
mtext(paste0("\u25B2\n \n", round(HIST.SPAWN[i]/1000), "\nHist."),
side=3, line=-4, at=max(year.tk)-1, font=2, col=blindcolz[col.spa])
mtext("|",
side=3, line=-1.5, at=max(year.tk)-1, font=2, col=blindcolz[col.spa])
mtext("Population estimate  (thousands)", side=2, line=3, outer=TRUE)
mtext("Population estimate  (thousands)", side=2, line=3, las=2, outer=TRUE)
mtext("Population estimate  (thousands)", side=2, line=3, las=0, outer=TRUE)
round(HIST.SPAWN[i]/1000)
yr
mtext(paste0("\u25B2\n \n", round(HIST.SPAWN[i]/1000), "\nHist."),
side=3, line=-4, at=yr[2]-1, font=2, col=blindcolz[col.spa])
mtext("|",
side=3, line=-1.5, at=yr[2]-1, font=2, col=blindcolz[col.spa])
fig <- function() {
par(mar=c(4, 5, 0.5, 4), oma=c(0, 4, 0, 0), yaxs="i", las=1)
sel <- sel1 & !is.na(index)
yr <- 1.02*range(0, rev(index.hi[sel]/1000)[1:20])
plot(wound.year[sel], index[sel]/1000, type="n", ylim=yr,
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
plab <- pretty(yr * index2pe[i])
axis(2, at=plab/index2pe[i], labels=plab, outer=TRUE)
mtext("Population estimate  (thousands)", side=2, line=3, las=0,
outer=TRUE)
mtext(paste0("\u25B2\n \n", round(HIST.SPAWN[i]/1000), "\nHist."),
side=3, line=-4, at=yr[2]-1, font=2, col=blindcolz[col.spa])
mtext("|",
side=3, line=-1.5, at=yr[2]-1, font=2, col=blindcolz[col.spa])
}
par(mar=c(4, 5, 0.5, 4), oma=c(0, 4, 0, 0), yaxs="i", las=1)
sel <- sel1 & !is.na(index)
yr <- 1.02*range(0, rev(index.hi[sel]/1000)[1:20])
plot(wound.year[sel], index[sel]/1000, type="n", ylim=yr,
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
plab <- pretty(yr * index2pe[i])
axis(2, at=plab/index2pe[i], labels=plab, outer=TRUE)
mtext("Population estimate  (thousands)", side=2, line=3, las=0,
outer=TRUE)
mtext(paste0("\u25B2\n \n", round(HIST.SPAWN[i]/1000), "\nHist."),
side=3, line=-4, at=yr[2]-1, font=2, col=blindcolz[col.spa])
mtext("|",
side=3, line=-1.5, at=yr[2]-1, font=2, col=blindcolz[col.spa])
par("usr")
mtext(paste0("\u25B2\n \n", round(HIST.SPAWN[i]/1000), "\nHist."),
side=3, line=-4, at=par("usr")[1], font=2, col=blindcolz[col.spa])
par(mar=c(4, 5, 0.5, 0.5), oma=c(0, 4, 0, 0), yaxs="i", las=1)
sel <- sel1 & !is.na(index)
xr <- range(wound.year[sel]) + c(-3, 0)
yr <- 1.02*range(0, rev(index.hi[sel]/1000)[1:20])
plot(wound.year[sel], index[sel]/1000, type="n", xlim=xr, ylim=yr,
xlab="Wounding year", ylab="Adult sea lamprey index  (thousands)")
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
plab <- pretty(yr * index2pe[i])
axis(2, at=plab/index2pe[i], labels=plab, outer=TRUE)
mtext("Population estimate  (thousands)", side=2, line=3, las=0,
outer=TRUE)
mtext(paste0("\u25B2\n \n", round(HIST.SPAWN[i]/1000), "\nHist."),
side=3, line=-4, at=xr[1]+1, font=2, col=blindcolz[col.spa])
mtext("|", side=3, line=-1.5, at=xr[1]+1, font=2,
col=blindcolz[col.spa])
par(mar=c(4, 5, 0.5, 0.5), oma=c(0, 4, 0, 0), yaxs="i", las=1)
sel <- sel1 & !is.na(index)
xr <- range(wound.year[sel]) + c(-3, 0)
yr <- 1.02*range(0, rev(index.hi[sel]/1000)[1:20])
plot(wound.year[sel], index[sel]/1000, type="n", axes=FALSE,
xlim=xr, ylim=yr,
xlab="Wounding year", ylab="Population estimate  (thousands)")
# shadepoly(x=wound.year, ymd=index.3mn/1000,
#   ylo=index.3lo/1000,
#   yhi=index.3hi/1000, subsel=sel, kol=blindcolz[col.spa], smooth=0)
# lines(wound.year[sel], index.3mn[sel]/1000, col=blindcolz[col.spa])
abline(h=TARGET$index.target[i]/1000, col=blindcolz[col.tar], lty=3)
arrows(wound.year[sel], index.lo[sel]/1000, wound.year[sel],
index.hi[sel]/1000,
angle=90, length=0.02, code=3, col=blindcolz[col.spa])
points(wound.year[sel], index[sel]/1000, pch=18,
col=blindcolz[col.spa])
axis(1)
plab <- pretty(yr * index2pe[i])
axis(2, at=plab/index2pe[i], labels=plab)
axis(2, outer=TRUE)
mtext("Adult sea lamprey index  (thousands)", side=2, line=3, las=0,
outer=TRUE)
mtext(paste0("\u25B2\n \n", round(HIST.SPAWN[i]/1000), "\nHist."),
side=3, line=-4, at=xr[1]+1, font=2, col=blindcolz[col.spa])
mtext("|", side=3, line=-1.5, at=xr[1]+1, font=2,
col=blindcolz[col.spa])
